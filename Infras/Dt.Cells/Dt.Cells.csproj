<Project Sdk="Microsoft.NET.Sdk">
	<PropertyGroup>
		<Version>3.0.0</Version>
        <PackageId Condition="'$(Configuration)'=='Debug'">Dt.Infras.Debug</PackageId>
        <PackageId Condition="'$(Configuration)'=='Release'">Dt.Infras</PackageId>
		<Description>搬运工客户端 Excel Chart 等基础控件</Description>
		<GenerateDocumentationFile>True</GenerateDocumentationFile>
	</PropertyGroup>

    <Import Project="..\Common.props" />
    <Import Project="..\..\Client\Package.props" />

	<!-- 包图标 -->
	<ItemGroup>
		<None Include="..\..\logo.png">
			<Pack>True</Pack>
			<PackagePath>\</PackagePath>
		</None>
	</ItemGroup>

	<ItemGroup>
		<EmbeddedResource Include="Res\FunctionInformation.xml" />
        <EmbeddedResource Include="Res\FunctionInformation.zh_CN.xml" />
	</ItemGroup>

    <!--win上将图片嵌入到Pri，不使用嵌入资源方式-->
    <!--因二进制文件作为嵌入资源时，不但会放入dll，而且会在pri列表中作为外部资源文件，造成在被引用时总要复制无用的文件-->
    <!--文件文件作为嵌入资源时，和传统一致，放入dll，与pri无任何关系-->
    <ItemGroup Condition="$(TargetFramework.Contains('-windows'))">
        <Content Remove="Dt.Cells\**" />
        <MyEmbeddedItems Include="Dt.Cells\Icons\**" />
    </ItemGroup>
    
    <Target Name="AddMyEmbeddedItems" BeforeTargets="_GenerateProjectPriFileCore" AfterTargets="_CalculateInputsForGenerateProjectPriFileCore" Condition="$(TargetFramework.Contains('-windows'))">
        <Copy SourceFiles="@(MyEmbeddedItems)" DestinationFolder="$(IntermediateOutputPath)\embed\Dt.Cells\Icons\" />
        <ReadLinesFromFile File="$(_EmbedFileResfilePath)">
            <Output TaskParameter="Lines" ItemName="ItemsFromFile" />
        </ReadLinesFromFile>

        <ItemGroup>
            <MyEmbeddedFileList Include="@(ItemsFromFile)" />
            <MyEmbeddedFileList Include="@(MyEmbeddedItems)" />
        </ItemGroup>

        <WriteLinesToFile File="$(_EmbedFileResfilePath)" Lines="@(MyEmbeddedFileList)" Overwrite="true" Encoding="Unicode" />
    </Target>

    <!--其它平台仍使用嵌入资源-->
    <ItemGroup Condition="!$(TargetFramework.Contains('-windows'))">
        <EmbeddedResource Include="Dt.Cells\Icons\**" />
    </ItemGroup>
    
	<ItemGroup>
		<!--PrivateAssets避免引用项目的 nuget 包-->
		<ProjectReference Include="..\Dt.CalcEngine\Dt.CalcEngine.csproj" PrivateAssets="all" />
		<ProjectReference Include="..\Dt.Xls\Dt.Xls.csproj" PrivateAssets="all" />
		<ProjectReference Include="..\Dt.Pdf\Dt.Pdf.csproj" PrivateAssets="all" />
		<ProjectReference Include="..\Dt.Charts\Dt.Charts.csproj" PrivateAssets="all" />
		<ProjectReference Include="..\Dt.Cells.Data\Dt.Cells.Data.csproj" PrivateAssets="all" />
	</ItemGroup>

    <ItemGroup Condition="$(TargetFramework.Contains('-ios'))">
        <!-- GMImagePicker.Xamarin不再升级，升.net6.0不兼容，合并 -->
        <ProjectReference Include="..\GMImagePicker\GMImagePicker.csproj" PrivateAssets="all" />
    </ItemGroup>
</Project>
